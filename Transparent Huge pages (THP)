
Verify if THP is enabled

“tuned.service” on RHEL 7 set the transparent_hugepage to always by default. Even if its disabled in grub kernel command line, the tuned service will set it to ‘always‘ during boot. Below command output confirm that the THP are enabled on the system.

# cat /sys/kernel/mm/transparent_hugepage/enabled
[always] madvise never


Steps to disable

1.	Add the “transparent_hugepage=never” kernel parameter option to the grub2 configuration file.

              # vi /etc/default/grub
              GRUB_TIMEOUT=5
              GRUB_DEFAULT=saved
              GRUB_DISABLE_SUBMENU=true
              GRUB_TERMINAL_OUTPUT="console"
              GRUB_CMDLINE_LINUX="nomodeset crashkernel=auto rd.lvm.lv=vg_os/lv_root rd.lvm.lv=vg_os/lv_swap rhgb quiet transparent_hugepage=never"
              GRUB_DISABLE_RECOVERY="true"

2.	Rebuild the /boot/grub2/grub.cfg file by running the grub2-mkconfig -o command. Before rebuilding the GRUB2 configuration file, ensure to     take a backup of the existing /boot/grub2/grub.cfg.

              # grub2-mkconfig -o /boot/grub2/grub.cfg

        3.  Reboot the system and verify option are in effect.

              # shutdown -r now

         4.  Verify the parameter is set correctly

               # cat /proc/cmdline
               BOOT_IMAGE=/vmlinuz-3.10.0-514.10.2.el7.x86_64 root=/dev/mapper/vg_os-lv_root ro nomodeset crashkernel=auto rd.lvm.lv=vg_os/lv_root
               rd.lvm.lv=vg_os/lv_swap rhgb quiet transparent_hugepage=never LANG=en_US.UTF-8

Note : Transparent Huge Pages cannot be enabled/disabled on a running machine and requires a reboot
